function e(e,t,n=-1){e.tokenStream.push({token:e.state,startIndex:e.startIndex,endIndex:t+n}),e.startIndex=t}let t,n,s,a,d,o=0,r=0,l=0,i=0,c="//hel   lo world program\npush 100000 // asdf\nload %rd // asdfg\nload %ra // asdfg\nload %rc // asdfg\nlog %rd\npush 200\n\nmy-label:\ninc %rc, 1\njl my-label\n\nhalt";var E;E=()=>{t=document.getElementById("editor"),n=document.querySelector(".cursor");const e=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--editor-font-size"));o=.6*e,r=1.25*e,console.log({fontSize:e,fontLength:o,fontHeight:r}),s=t.offsetTop,a=t.offsetLeft,document.addEventListener("keydown",(e=>{if("F5"!==e.key&&e.preventDefault(),1===e.key.length){const t=" "!==e.key?e.key:" ",n=c.split("\n"),s=n[i];n[i]=s.slice(0,l)+t+s.slice(l),c=n.join("\n"),l++,f()}else if("Backspace"===e.key){const e=c.split("\n"),t=e[i];e[i]=t.slice(0,l-1)+t.slice(l),c=e.join("\n"),l--,f()}else if("Delete"===e.key){const e=c.split("\n"),t=e[i];e[i]=t.slice(0,l)+t.slice(l+1),c=e.join("\n"),f()}else if("Enter"===e.key){const e=c.split("\n"),t=e[i];e[i]=t.slice(0,l)+"\n"+t.slice(l),c=e.join("\n"),i++,l=0,f()}else"ArrowRight"===e.key?l++:"ArrowLeft"===e.key?l--:"ArrowDown"===e.key?i++:"ArrowUp"===e.key&&i--;console.log(e.key),p()})),setTimeout((()=>{f(),p()}),500),console.log("after")},"complete"===document.readyState||"interactive"===document.readyState?setTimeout(E,1):document.addEventListener("DOMContentLoaded",E);const I={TOKEN_INSTRUCTION:"instruction",TOKEN_CONST:"const",TOKEN_REGISTER:"register",TOKEN_COMMENT:"comment"};function f(){for(console.time("render"),d=function(t){const n=t.split(""),s={startIndex:0,state:"TOKEN_INSTRUCTION",tokenStream:[]};for(let t=0;t<n.length;++t)switch(n[t]){case" ":if("TOKEN_WHITESPACE"===s.state)break;e(s,t),s.state="TOKEN_WHITESPACE";break;case":":s.state="TOKEN_LABEL";break;case"\n":s.startIndex!==t&&e(s,t),s.state="TOKEN_NEWLINE",e(s,t,0),s.state="TOKEN_INSTRUCTION",s.startIndex=t+1;break;case"%":"TOKEN_WHITESPACE"===s.state&&(e(s,t),s.state="TOKEN_REGISTER");break;case",":e(s,t),s.state="TOKEN_COMMA";break;case"/":if(s.startIndex!==t&&e(s,t),"/"!==n[t+1]){s.state="TOKEN_INVALID";break}for(;"\n"!==n[t];)t++;s.state="TOKEN_COMMENT",--t;break;default:"TOKEN_WHITESPACE"===s.state&&(e(s,t),s.state="TOKEN_CONST")}return e(s,n.length-1,0),s.tokenStream}(c);t.firstChild;)t.removeChild(t.firstChild);let n,s=1;for(const e of d){n||(t.appendChild(T("line-number",s+":",e.startIndex,e.startIndex)),n=u("line"),n.dataset.startIndex=e.startIndex.toString(),s++);const a=I[e.token];if(a)n.appendChild(T(a,c.slice(e.startIndex,e.endIndex+1).replace(/\s/g," "),e.startIndex,e.endIndex));else switch(e.token){case"TOKEN_NEWLINE":n.dataset.endIndex=e.endIndex.toString(),t.appendChild(n),n=null;break;case"TOKEN_WHITESPACE":n.appendChild(T(a,new Array(e.endIndex-e.startIndex+2).join(" "),e.startIndex,e.endIndex));break;default:n.appendChild(T("not-found",c.slice(e.startIndex,e.endIndex+1),e.startIndex,e.endIndex))}}n&&t.appendChild(n),console.timeEnd("render")}function T(e,t,n,s){const a=document.createElement("span");return a.classList.add(e),a.textContent=t,a.dataset.startIndex=n.toString(),a.dataset.endIndex=s.toString(),a}function u(e){const t=document.createElement("div");return t.classList.add(e),t}function p(){const e=t.querySelector(".line-number").scrollWidth;n.style.top=s+i*r+"px",n.style.left=a+e-o/2+l*o+"px"}
